{#
# This file is part of WEKO3.
# Copyright (C) 2017 National Institute of Informatics.
#
# WEKO3 is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# WEKO3 is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with WEKO3; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#}
{%- from "weko_workflow/helpers.html" import render_identifier_link with context -%}
<input type="hidden" id="item_id" value="{{pid.pid_value}}" />
<!-- Confirm Modal -->
{% from "weko_theme/macros/modal_page.html" import approval_modal %}



<div class="panel panel-default">
    <div class="panel-heading">
        <span>{{_('Identifier Grant')}}</span>
    </div>
    <div class="panel-body" style="line-height: 1.6;">
        <h1>index_is_private_state ~ {{ index_is_private_state }}</h1>
        <h1>is_public_state ~ {{ is_public_state }}</h1>
        <h1>doi_information_key ~ {{ doi_information_key }}</h1>
        <h1>cur_step ~ {{ cur_step }}</h1>
        <hr>
        <h1>{{ record }}</h1>
        {% if not is_public_state %} <!-- TODO IF Public State Check S -->
            {% include 'weko_workflow/identifier_grant_private_doi_reservation.html' %}
        {% else %}
            {%- if temporary_idf_grant >= 0 %} <!-- TODO IF Main S -->
                {% if "." in record['_deposit']['id'] %} <!-- TODO IF 1 S -->
                    {% if doi_information_key %} <!-- TODO IF 1.1 S -->
                        {% if record[doi_information_key]["attribute_name"] == "Identifier Registration" %} <!-- TODO IF 2 S -->
                        <div class="row h-100">
                            <p class="text-center">
                                <button class="btn btn-danger withdraw-button" id="doi_is_reserved" disabled>
                                    {{_('DOI is reserved')}}
                                </button>
                            </p>
                        </div>
                        {% endif %} <!-- TODO IF 2 E -->
                    {% else %}
                        {% include 'weko_workflow/identifier_grant_form.html' %}
                    {% endif %} <!-- TODO IF 1.1 E -->
                {% else %}
                    {% include 'weko_workflow/identifier_grant_form.html' %}
                {% endif %} <!-- TODO IF 1 E -->
            {%- elif temporary_idf_grant == -1 %}
                {% include "weko_workflow/modal_withdraw_confirmation.html" %}
                <div class="row h-100">
                    <p class="text-center">
                        <button class="btn btn-danger withdraw-button" id="btn_withdraw">
                            {{_('Withdraw DOI')}}
                        </button>
                    </p>
                </div>
            {%- elif temporary_idf_grant == -2 %}
                <div class="row h-100">
                    <p class="text-center">
                        <span>{{_('DOI was withdrawn.')}}</span>
                    </p>
                </div>
            {%- else %}
                <div class="row h-100">
                    <p class="text-center">
                        <span>{{_('Items for which a DOI has been withdrawn can not be granted a DOI.')}}</span>
                    </p>
                </div>
            {%- endif %} <!-- TODO IF Main E -->
        {% endif %} <!-- TODO IF Public State Check E -->
    </div>
</div>
<br>
<button type="button" class="btn btn-info action-button" id="btn-back">
    <span class="glyphicon glyphicon-chevron-left"></span> {{_('Back')}}
</button>
<button type="button" class="btn btn-primary save-button" id="btn-draft"
    style="width: 120px; height: 40px;font-size: 15px;">
    <span class="glyphicon glyphicon-saved"></span> {{_('Save')}}
</button>
<button type="button" class="btn btn-info next-button" id="btn-finish">
    {{_('Next')}} <span class="glyphicon glyphicon-chevron-right"></span>
</button>
<button ng-disabled="recordsVM.invenioRecordsLoading" class="btn btn-danger done-button pull-right" id="btn_quit">
    <i class="fa fa-sign-out"></i> {{_('Quit_identifier_grand')}}
</button>